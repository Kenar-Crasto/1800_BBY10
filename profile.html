<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Optional styles and scripts of your own -->
    <link type="text/css" rel="" href="styles/my_style.css">

    <!-- Bootstrap FirebaseUI CSS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css" />

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI.js"></script>
    <title>LivePark</title>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
      <!-- Nav Bar -->
      <nav class="navbar navbar-expand-lg navbar-light bg-danger">
        <div class="container-fluid">
            <a class="navbar-brand" href="main.html">LivePark</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Nav Bar Buttons -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="main.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="input.html">Report</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Features
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="profile.html">View your profile</a></li>
                            <li><a class="dropdown-item" href="input.html">Rate parking status</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Edit profile settings</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#" tabindex="-1" aria-disabled="true">Support</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Form -->
    <div class="container">
        <h1>User Profile </h1>
        <form>
            <fieldset class="mb-3" id="personalInfoFields" disabled>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="nameInput" class="form-control" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label>School</label>
                    <input type="text" id="schoolInput" class="form-control" placeholder="Enter your school">
                </div>
                <div class="form-group">
                    <label>City</label>
                    <input type="text" id="cityInput" class="form-control" placeholder="Enter your city">
                </div>
            </fieldset>
            <div class="d-flex justify-content-end mt-5">
                <button type="button" class="btn btn-secondary" onclick="editUserInfo()">Edit</button>
                <span style="width: 10px"></span>
                <button type="button" class="btn btn-info" onclick="saveUserInfo()">Save</button>
            </div>
        </form>
    </div>

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->
    <!-- <script src="./scripts/my_script.js"></script> -->
    <script>
        var currentUser

        // Function for automatically filling in form with user information
        function populateInfo() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {

                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            //get the data fields of the user
                            var userName = userDoc.data().name;
                            var userSchool = userDoc.data().school;
                            var userCity = userDoc.data().city;

                            //if the data fields are not empty, then write them in to the form.
                            if (userName != null) {
                                document.getElementById("nameInput").value = userName;
                            }
                            if (userSchool != null) {
                                document.getElementById("schoolInput").value = userSchool;
                            }
                            if (userCity != null) {
                                document.getElementById("cityInput").value = userCity;
                            }
                        })
                } else {
                    // No user is signed in.
                    console.log("No user is signed in");
                }
            });
        }

        //call the function to run it 
        populateInfo();

        // Function that allows forms to be edited
        function editUserInfo() {
            //Enable the form fields
            document.getElementById('personalInfoFields').disabled = false;
        }
        
        // Function that saves users information into form
        function saveUserInfo() {
            userName = document.getElementById('nameInput').value;
            userSchool = document.getElementById('schoolInput').value;
            userCity = document.getElementById('cityInput').value;

            currentUser.update({
                    name: userName,
                    school: userSchool,
                    city: userCity
                })
                .then(() => {
                    console.log("Document successfully updated!");
                })
            document.getElementById('personalInfoFields').disabled = true;
        }
    </script>
</body>

</html>